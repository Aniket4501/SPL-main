generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model users {
  user_id                 String                    @id
  name                    String
  team_id                 String
  created_at              DateTime                  @default(now())
  updated_at              DateTime                  @updatedAt

  team                    teams                     @relation(fields: [team_id], references: [team_id])
  steps_raw               steps_raw[]
  leaderboard_individual  leaderboard_individual[]
}

model teams {
  team_id           String              @id
  team_name         String
  created_at        DateTime            @default(now())
  updated_at        DateTime            @updatedAt

  users             users[]
  leaderboard_team  leaderboard_team[]
}

model uploads {
  upload_id     Int       @id @default(autoincrement())
  file_name     String
  uploaded_by   String
  upload_date   DateTime
  challenge_day Int
  uploaded_at   DateTime    @default(now())
  status        String       @default("active") // active | superseded | failed

  steps_raw     steps_raw[]
}

model steps_raw {
  id             Int       @id @default(autoincrement())
  user_id        String
  date           DateTime
  challenge_day  Int
  steps          Int
  source         String?
  uploaded_at    DateTime    @default(now())
  upload_id      Int

  user           users       @relation(fields: [user_id], references: [user_id])
  upload         uploads     @relation(fields: [upload_id], references: [upload_id])
}

model leaderboard_individual {
  id            Int       @id @default(autoincrement())
  user_id       String
  date          DateTime
  challenge_day Int
  steps         Int
  runs          Float
  processed_at  DateTime  @default(now())

  user          users     @relation(fields: [user_id], references: [user_id])

  @@unique([user_id, challenge_day], name: "user_day_unique")
}

model leaderboard_team {
  id            Int       @id @default(autoincrement())
  team_id       String
  date          DateTime
  challenge_day Int
  total_steps   Int
  total_runs    Float
  processed_at  DateTime  @default(now())

  team          teams      @relation(fields: [team_id], references: [team_id])

  @@unique([team_id, challenge_day], name: "team_day_unique")
}
